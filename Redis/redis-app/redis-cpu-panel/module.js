/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data","@grafana/runtime","rxjs"],(function(e,t,n,r,o){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=14)}([function(t,n){t.exports=e},function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"d",(function(){return s})),n.d(t,"f",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"e",(function(){return p}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function u(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}Object.create;function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function l(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function p(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}Object.create},function(e,n){e.exports=t},,function(e,t){e.exports=n},function(e,t){e.exports=r},,function(e,t){e.exports=o},,,,,,,function(e,t,n){"use strict";n.r(t);var r,o,a,i=n(4),u=n(1),s=n(0),c=n.n(s),l=n(5),p=n(2);!function(e){e.User="used_cpu_user",e.System="used_cpu_sys"}(o||(o={})),function(e){e.User="user",e.System="system"}(a||(a={}));var f=((r={})[a.System]="System",r[a.User]="User",r),d=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.state={timeRange:t.getTimeRange(n.props.timeRange,n.props.timeZone)},n}return Object(u.c)(t,e),t.getGraphDataFrame=function(e){return Object.entries(e).reduce((function(e,t,n){var r=Object(u.f)(t,2),o=r[0],a=r[1].reduce((function(e,t){var n=t.time,r=t.value;return{times:e.times.concat([n]),values:e.values.concat([r])}}),{times:[],values:[]}),s=a.times,c=a.values,d=p.colors[n%p.colors.length],m=Object(i.toDataFrame)({name:o,fields:[{type:i.FieldType.time,name:"time",values:s},{type:i.FieldType.number,name:" ",values:c,config:{unit:"percent",color:{fixedColor:d,mode:i.FieldColorModeId.Fixed},displayName:f[o],custom:{gradientMode:null===p.GraphGradientMode||void 0===p.GraphGradientMode?void 0:p.GraphGradientMode.Hue,fillOpacity:50,stacking:{mode:null===p.StackingMode||void 0===p.StackingMode?void 0:p.StackingMode.Normal,group:"stackA"}}}}]});m.fields=m.fields.map((function(e){return Object(u.a)(Object(u.a)({},e),{display:Object(i.getDisplayProcessor)({field:e,theme:l.config.theme2})})}));for(var y=[],v=0;v<s.length;v++)y.push([s[v].valueOf(),c[v]]);return e.concat(m)}),[])},t.getTimeRange=function(e,t){var n=Object(i.dateTimeParse)(e.raw.from,{timeZone:t}),r=Object(i.dateTimeParse)(e.raw.to,{timeZone:t});return{from:n,to:r,raw:{from:e.raw.from,to:r}}},t.getDerivedStateFromProps=function(e){return{timeRange:t.getTimeRange(e.timeRange,e.timeZone)}},t.prototype.render=function(){var e=this,n=this.props,r=n.width,o=n.height,a=n.seriesMap,i=this.state.timeRange,u=t.getGraphDataFrame(a);return u.length?c.a.createElement(p.TimeSeries,{frames:u,width:r,height:o,timeRange:i,legend:{displayMode:null===p.LegendDisplayMode||void 0===p.LegendDisplayMode?void 0:p.LegendDisplayMode.List,placement:"bottom",calcs:[]},timeZone:this.props.timeZone},(function(t,n){return c.a.createElement(p.TooltipPlugin,{config:t,data:n,mode:p.TooltipDisplayMode.Multi,timeZone:e.props.timeZone})})):c.a.createElement("div",null,"Gathering usage data...")},t}(s.PureComponent),m=n(7),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={seriesMap:{}},t}return Object(u.c)(t,e),t.getValuesForCalculation=function(e){var t=e.fields.find((function(e){return e.name===o.User})),n=e.fields.find((function(e){return e.name===o.System}));return{time:Object(i.dateTime)(),user:null==t?void 0:t.values.toArray().map((function(e){return e}))[0],system:null==n?void 0:n.values.toArray().map((function(e){return e}))[0]}},t.getSeriesMap=function(e,t,n,r){void 0===r&&(r=1e3);var o=Object(u.a)({},e),a=(n.user-t.user)/(n.time.diff(t.time)/1e3)*100,s=(n.system-t.system)/(n.time.diff(t.time)/1e3)*100,c=Object(i.dateTime)(),l={user:{time:c,value:a>=0?a:0},system:{time:c,value:s>=0?s:0}};return Object.keys(f).forEach((function(e){o[e]?o[e].length+1>r?o[e]=Object(u.h)(Object(u.h)([],Object(u.f)(o[e].slice(1,o[e].length)),!1),[l[e]],!1):o[e]=o[e].concat(l[e]):o[e]=[l[e]]})),o},t.prototype.componentDidMount=function(){this.updateData(),void 0!==this.props.options.interval&&this.setRequestDataInterval()},t.prototype.componentDidUpdate=function(e,t){e.options.interval!==this.props.options.interval&&this.setRequestDataInterval()},t.prototype.componentWillUnmount=function(){this.clearRequestDataInterval()},t.prototype.makeQuery=function(){var e;return Object(u.b)(this,void 0,Promise,(function(){var t,n,r,o,a;return Object(u.d)(this,(function(i){switch(i.label){case 0:return t=null===(e=this.props.data.request)||void 0===e?void 0:e.targets,n="",t&&t.length&&t[0].datasource&&(n=t[0].datasource),n&&t?[4,Object(l.getDataSourceSrv)().get(n)]:[2,Promise.resolve(null)];case 1:return r=i.sent(),o=t.map((function(e){return Object(u.a)({command:"info",section:"cpu"},e)})),a=r.query(Object(u.a)(Object(u.a)({},this.props.data.request),{targets:o})),[2,Object(m.lastValueFrom)(a)]}}))}))},t.prototype.updateData=function(){return Object(u.b)(this,void 0,void 0,(function(){var e,n,r,o,a,i,s,c;return Object(u.d)(this,(function(u){switch(u.label){case 0:return[4,this.makeQuery()];case 1:return null===(e=u.sent())?[2,Promise.resolve()]:(n=this.state,r=n.values,o=n.seriesMap,(a=e.data[0])?(i=t.getValuesForCalculation(a),r||(r=i),s=this.props.options.maxItemsPerSeries||300,c=t.getSeriesMap(o,r,i,s),this.setState({values:i,seriesMap:c}),[2]):[2,Promise.resolve()])}}))}))},t.prototype.setRequestDataInterval=function(){var e=this;void 0!==this.requestDataTimer&&this.clearRequestDataInterval(),this.requestDataTimer=setInterval((function(){e.updateData()}),this.props.options.interval||1e3)},t.prototype.clearRequestDataInterval=function(){void 0!==this.requestDataTimer&&(clearTimeout(this.requestDataTimer),delete this.requestDataTimer)},t.prototype.render=function(){var e=this.props.height,t=this.state.seriesMap;return c.a.createElement(d,Object(u.a)({},this.props,{height:e,seriesMap:t}))},t}(s.PureComponent);n.d(t,"plugin",(function(){return v}));var v=new i.PanelPlugin(y).setPanelOptions((function(e){return e.addSliderInput({path:"interval",name:"Interval to run INFO command, ms",settings:{min:100,max:3e4},defaultValue:1e3}).addSliderInput({path:"maxItemsPerSeries",name:"Number of Samples",settings:{min:10,max:500},defaultValue:300})}))}])}));
//# sourceMappingURL=module.js.map